{"title":"Tidy Data","markdown":{"headingText":"Tidy Data","containsRefs":false,"markdown":"\n**Week 2** - Tidying data and clean code\n\nIn this workshop, you will learn how transform raw data to something usable for analysis, and get familiar with clean code.\n\n\n![](images/base_transform.png)\n\n## Background reading {.unnumbered}\n\nSometimes, it is rare that you get the data in exactly the right form you need from the raw data you import into R.\nOften you‚Äôll need to create some new variables or summaries, or maybe you just want to rename the variables or reorder the observations in order to make the data a little easier to work with.\nIn this workshop you are going to learn the five key `dplyr` functions (part of tidyverse) that allow you to solve the vast majority of your data manipulation challenges:\n\n- Pick observations by their **values** ([`filter()`](https://dplyr.tidyverse.org/reference/filter.html)). e.g. keeping rows with values higher than 100.\n- **Reorder** the rows ([`arrange()`](https://dplyr.tidyverse.org/reference/arrange.html)). e.g. rearrange a numeric column by the largest values.\n- Pick variables by their **names** ([`select()`](https://dplyr.tidyverse.org/reference/select.html)). e.g. keeping selected columns only.\n- **Create** new variables with functions of existing variables ([`mutate()`](https://dplyr.tidyverse.org/reference/mutate.html)). e.g. the sum of values from two numeric columns. \n- Collapse many values down to a single **summary** ([`summarise()`](https://dplyr.tidyverse.org/reference/summarise.html)). e.g. getting the overall mean of the dataset.\n\nThese can all be used in conjunction with [`group_by()`](https://dplyr.tidyverse.org/reference/group_by.html) which changes the scope of each function from operating on the entire dataset to operating on it **group-by-group**. These **six functions** provide the verbs for a language of data manipulation.\n\nAll verbs work similarly:\n\n- The first argument is a data frame.\n- The subsequent arguments describe what to do with the data frame, using the variable names (without quotes).\n- The result is a new data frame.\n\nTogether these properties make it easy to chain together multiple simple steps to achieve a complex result. Let‚Äôs dive in and see how these verbs work.\n\n\n### Study context {.unnumbered}\n\nIn order to know whether our imported data requires transformation before analysis, we need to know what we are analysing.\nLet's stick with a familiar dataset, the `plant_calcium.csv` from this [study](https://lter.github.io/lterdatasampler/articles/hbr_maples_vignette.html).\n\n\nThe `plant_calcium.csv` dataset contains observations on sugar maple seedlings in **untreated** and **calcium-treated** watersheds at Hubbard Brook Experimental Forest in New Hampshire, USA.\n\nGrowth of sugar maples (*Acer saccharum*), known for their maple syrup and iconic leaf shape, can be stunted due to soil acidification from prolonged [acid rain](https://news.cornell.edu/stories/2006/05/acid-rain-causing-decline-sugar-maples-say-researchers), which leaches calcium - a nutrient important for plant growth - from soils and stresses maple seedlings.\n\nTo investigate the impact of soil calcium supplementation on sugar maple seedling growth, researchers at the Hubbard Brook Long Term Ecological Research (LTER) site recorded ‚Äúgeneral sugar maple germinant health by height, leaf area, biomass, and chlorophyll content‚Äù [@Juice2006] for seedlings in untreated and previously calcium-treated watersheds [@Peters2004]. \nBy comparing seedling growth in calcium-treated (**W1**) versus untreated (**Reference**) watersheds, calcium impacts on sugar maple seedling growth can be explored.\n\n![Sugar maple seedling laboratory photos. Photo credit: Tom Siccama.](images/hbr_maples_img_4.jpg)\n\n# Data Manipulation  {.unnumbered}\n\nBefore we start, load your previous assessment workflow with the `plant_task_data_clean.csv` dataset (errors removed). Here, we will call the imported as `plant_task_clean_data`.\n\n```{r load data, include=FALSE}\n#install.packages(\"visdat\")\n\nlibrary(tidyverse)\nlibrary(visdat)\n\n# Load a CSV file\nplant_task_clean_data <- read_csv(\"C:/Users/75002992/OneDrive - Murdoch University/Teaching/ECS200 - Research Methods in Ecology/ECS200 - Workshop/data/plant_calcium_task.csv\") %>%\n  dplyr::mutate(watershed = recode(watershed, \"W2\" = \"W1\"),\n                watershed = as.factor(watershed),\n                transect  = as.factor(transect)) %>%\n  dplyr::filter(stem_dry_mass < 1)\n\n```\n\n\n::: {.panel-tabset .nav-pills}\n\n## Filter rows with filter() {.unnumbered}\n\n![](images/transform_filter.png)\n\n`filter()` allows you to subset observations based on their values.\nThe first argument is the name of the data frame.\nThe second and subsequent arguments are the expressions that filter the data frame.\nFor example, we can select all values for the year 2004 for the calcium-treated sites (W1):\n\n\n```{r filter, eval=FALSE}\n\n# filter function by two columns. A numeric and a categorical.\nfilter(plant_task_clean_data, year == 2004, watershed == \"W1\")\n\n```\n\nYou can also filter rows by more one variable in a column using `x %in% y` logic.  This will select every row where `x` is one of the values in `y`.\nFor example, we can select all values in transect R1 and W1-1 only:\n\n```{r filter2, eval=FALSE}\n\n# filter function for the transect column by \"R1\" and \"W1-1\"\nfilter(plant_task_clean_data, transect %in% c(\"R1\", \"W1-1\"))\n\n```\n\nLastly, you can filter by number thresholds. e.g. filtering out extreme values (i.e. for data quality checks), or filter within a range of values.\nFor example, we can select all `stem_dry_mass values` below 0.9 or between 0.01-0.02:\n\n```{r filter3, eval=FALSE}\n\n# filter function by stem_dry_mass values below 0.9\nfilter(plant_task_clean_data, stem_dry_mass <= 0.9)\n\n# filter function by stem_dry_mass values between 0.01 and 0.02\nfilter(plant_task_clean_data, stem_dry_mass > 0.01 & stem_dry_mass < 0.02)\n\n```\n\nOther possible functions and operators within the `filter()` function can be found [here](https://dplyr.tidyverse.org/reference/filter.html).\n\n\n## Arrange rows with arrange() {.unnumbered}\n\n![](images/transform_arrange.png)\n\n`arrange()` works similarly to `filter()` except that instead of selecting rows, it changes their order.\nIt takes a data frame and a set of column names (or more complicated expressions) to order by.\nIf you provide more than one column name, each additional column will be used to break ties in the values of preceding columns:\n\n\n```{r arrange, eval=FALSE}\n\n# Order the dataset by the ascending stem_length value (lowest in top row to highest in bottom row)\narrange(plant_task_clean_data, stem_length)\n\n# Order the dataset by the descending stem_length value (highest in top row to lowest in bottom row)\narrange(plant_task_clean_data, desc(stem_length))\n\n```\n\n**Note**: Missing values are always sorted at the end.\n\n\n## Select columns with select() {.unnumbered}\n\n![](images/transform_select.png)\n\nIt‚Äôs not uncommon to get datasets with hundreds or even thousands of variables.\nIn this case, the first challenge is often narrowing in on the variables you‚Äôre actually interested in.\n`select()` allows you to rapidly zoom in on a useful subset using operations based on the names of the variables.\n\n\n```{r select, eval=FALSE}\n\n# Select only three varaibles to keep.\nselect(plant_task_clean_data, year, watershed, stem_dry_mass)\n\n```\n\n\n## Add new variables with mutate() {.unnumbered}\n\n![](images/transform_mutate.png)\n\nBesides selecting sets of existing columns, it‚Äôs often useful to add new columns that are functions of existing columns. That‚Äôs the job of `mutate()`.\n\n`mutate()` always adds new columns at the end of your dataset so we‚Äôll start by creating a narrower dataset so we can see the new variables. \n\n```{r mutate, eval=FALSE}\n\n# Calculate the total dry mass from leaf_dry_mass and stem_dry_mass and correct the unit from kilogram to gram\nplant_task_clean_data <- mutate(plant_task_clean_data,\n                                total_dry_mass = leaf_dry_mass + stem_dry_mass,\n                                total_dry_mass_g = total_dry_mass * 1000) # convert kilogram to gram\n\n```\n\n\n## Grouped summaries with summarise() {.unnumbered}\n\n![](images/transform_summarise.png)\n\nThe last key verb is `summarise()`. It collapses a data frame to a single row. \nHowever, `summarise()` is not terribly useful unless we pair it with `group_by()`. \nThis changes the unit of analysis from the complete dataset to individual groups.\nThen, when you use the dplyr verbs on a grouped data frame they‚Äôll be automatically applied ‚Äúby group‚Äù. \nFor example, if we applied exactly the same code to a data frame (`plant_task_clean_data`) grouped by watershed, we get the average values per treatment:\n\n```{r summarise, eval=FALSE}\n\n# Get the mean total_dry_mass_g by treatment groups\nplant_task_clean_data %>%\n  group_by(watershed) %>%\n  summarise(mean = mean(total_dry_mass_g))\n\n```\n\nWhat happens if we try to summarise a dataset with NA's inside?\n\n```{r NA data, eval=FALSE}\n\n# Here is an example dataset\nNA_data <- data.frame(site = c(\"A\", \"B\", \"A\", \"B\", \"A\", \"B\"),\n                      species = c(3, 4, 6, 2, 4, NA))\n\n\n# Get the mean species by site\nNA_data %>%\n  group_by(site) %>%\n  summarise(mean = mean(species))\n\n\n# Try this now with na.rm = TRUE\nNA_data %>%\n  group_by(site) %>%\n  summarise(mean = mean(species, na.rm = TRUE))\n\n```\n\n\nThat‚Äôs because aggregation functions obey the usual rule of missing values: if there‚Äôs any missing value in the input, the output will be a missing value.\nFortunately, all aggregation functions have an na.rm argument which removes the missing values prior to computation. If your dataset has NAs, the `na.rm = TRUE` argument will be helpful.\n\n:::\n\n## Exercise (15 min) {.unnumbered}\n\nüß™ **Use the previous functions to complete the following task for the `fake_data` below**\n\n```{r ex 1}\n\nfake_data <- data.frame(\n  site = c(\"A\", \"B\", \"C\", \"A\", \"B\", \"A\", \"B\", \"C\", \"A\", \"B\", \"A\", \"B\", \"A\", \"B\", \"C\", \"C\", \"B\", \"A\", \"b\", \"C\", \"B\", \"C\", \"C\", \"A\", \"A\", \"A\", \"A\", \"B\", \"C\", \"C\", \"C\"),\n  species_1 = as.integer(c(7, 25, 30, 50, 38, 13, 5, 31, 34, 22, 41, 25, 22, 37, 39, 13, 45, 10, 40, 7, 28, 36, 19, 2, 12, 5, 16, 38, 27, 44, 44)),\n  species_2 = as.integer(c(9, 8, 1 , 7, 9 , 9, 4, 8, 1, 7, 1, 6, 4, 4, 7, 2, 8, 7, 2, 9, 9, 2, 6, 8, 6, 6, 17, 1, 8, 4, 4)),\n  species_3 = as.integer(c(190, 160, 70, 430, 310, 99, 530, 420, 371, 357, 198, 171, 463, 124, 254, 484, 435, 409, 122, 305, 410, 162, 473, 200, 401, 273, 421, 419, 293, 487, 487)),\n  species_4 = as.integer(c(2, 0, 4, 8, 6, 3, 7, 4, 2, NA, 35, 10, 6, 4, 8, 1, 1, 0, NA, 4, 6, 8, 10, 6, 2, 5, 10, 7, NA, NA, NA))\n  )\n\n```\n\n\n- Conduct the usual **quality check** on this dataset (slightly different mistakes).\n- Create a new variable column called `total_sp` that combines all the species.\n- Select only the `site` and `total_sp` variable into a new dataframe.\n- Calculate the mean, minimum, maximum, and count of `total_sp` by site.\n\n\nQuestion:\n\n1. What is the mean total abundance in site B?\n2. What is the problem with using mean here? Is there a better way to calculate central tendancy for dount data? (**hint**: think of decimals in this context).\n3. Which site has the highest average species abundance?\n4. Which site has the most replicate samples?\n\n<details>\n<summary><strong>Show answer</strong></summary>\n\n```{r ans 1, eval=FALSE}\n\nstr(fake_data)\n\n# there is an inconsistent coding in one of the categorical variables, and an extreme value in one of the numeric variables to remove.\n\nfake_data_clean <- fake_data %>%\n  dplyr::mutate(site = recode(site, \"b\" = \"B\"),\n                site = as.factor(site)) %>%\n  dplyr::filter(species_4 < 30) %>%\n  dplyr::mutate(total_sp = species_1 + species_2 + species_3 + species_4) %>%\n  dplyr::select(site, total_sp)\n\nfake_data_clean %>%\n  dplyr::group_by(site) %>%\n  dplyr::summarise(mean = mean(total_sp),\n                   min  = min(total_sp),\n                   max  = max(total_sp),\n                   n = n())\n\n# 1. 361.25 \n# 2. Mode more suitable for integers\n# 3. Site B\n# 4. site A\n\n```\n\n</details>\n\n\n# Part 2 - Tidy code {.unnumbered}\n\nGood coding style is like correct punctuation: you can manage without it, butitsuremakesthingseasiertoread.\nI mostly comfortable with the tidyeverse syntax, but the most important take away here is **keep everything consistent** if you prefer a different style.\n\n\nThe full breakdown can be found [here](https://style.tidyverse.org/).\n\n::: {.panel-tabset .nav-pills}\n\n## File names {.unnumbered}\n\nFile names should be **machine readable**: avoid spaces, symbols, and special characters.\nPrefer file names that are all lower case, and never have names that differ only in their capitalisation. \nDelimit words with `-` or `_`. Use .R as the extension of R files.\n\n```{r file 1, eval=FALSE}\n\n# Good\nfit_models.R\nutility_functions.R\nexploratory-data-analysis.R\n\n# Bad\nfit models.R\nfoo.r\nExploratoryDataAnaylsis.r\n\n```\n\nFile names should be **human readable**: use file names to describe what‚Äôs in the file.\n\n```{r file 2, eval=FALSE}\n\n# Good\nreport-draft-notes.txt\n\n# Bad\ntemp.r\n```\n\nUse the same structure for closely related files:\n\n```{r file 3, eval=FALSE}\n# Good\nfig-eda.png\nfig-model-3.png\n\n# Bad\nfigure eda.PNG\nfig model three.png\n\n```\n\n\n## R organisation {.unnumbered}\n\nUse commented lines of `-` to break up your file into easily readable chunks.\nHere is a **template** you can use for your future projects. \n\n```{r organisation}\n# Title.\n# Short description of what is being done.\n# Authors name and date of analysis.\n\n\n## Set up ## ----------------------------------------------------------------\n\n# any code related to setting up directory, installing and loading packages (e.g. from workshop 1)\n\n## Loading and cleaning data ## ---------------------------------------------\n\n# any code relating to loading the data, checking the quality, transforming the dataset, so that it is ready for analysis\n\n\n## Analysis ## -------------------------------------------------------------\n\n# All code involved with preliminary analysis, full analysis, and model output\n\n## Visualisation ## --------------------------------------------------------\n\n# Creating beautiful figures for your report!\n\n```\n\n\n## Syntax {.unnumbered}\n\n### Object names {.unnumbered}\n\nVariable and function names should use only lowercase letters, numbers, and _. Use underscores (_) (so called snake case) to separate words within a name.\n\n```{r syntax 1, eval=FALSE}\n\n# Good\nday_one\nday_1\n\n# Bad\nDayOne\ndayone\n\n```\n\nGenerally, variable names should be nouns and function names should be verbs. Strive for names that are concise and meaningful (this is not easy!).\n\n```{r syntax 2, eval=FALSE}\n\n# Good\nday_one\n\n# Bad\nfirst_day_of_the_month\ndjm1\n\n```\n\nWhere possible, avoid re-using names of common functions and variables. This will cause confusion for the readers of your code.\n\n```{r syntax 3, eval=FALSE}\n\n# Bad\nT <- FALSE\nc <- 10\nmean <- function(x) sum(x)\n\n```\n\n### Infix operators {.unnumbered}\n\nMost infix operators (`==`, `+`, `-`, `<-`, etc.) should always be surrounded by spaces:\n\n```{r infix 1, eval=FALSE}\n\n# Good\nheight <- (feet * 12) + inches\nmean(x, na.rm = TRUE)\n\n# Bad\nheight<-feet*12+inches\nmean(x, na.rm=TRUE)\n\n```\n\nThere are a few exceptions, which should never be surrounded by spaces:\n\nThe operators with [high precedence](https://rdrr.io/r/base/Syntax.html): `::`, `:::`, `$`, `@`, `[`, `[[`, `^`, unary `-`, unary `+`, and `:`.\n\n```{r infix 2, eval=FALSE}\n\n# Good\nsqrt(x^2 + y^2)\ndf$z\nx <- 1:10\n\n# Bad\nsqrt(x ^ 2 + y ^ 2)\ndf $ z\nx <- 1 : 10\n\n```\n\n### Assignment {.unnumbered}\n\nUse `<-`, not `=`, for assignment.\n\n```{r assignment, eval=FALSE}\n\n# Good\nx <- 5\n\n# Bad\nx = 5\n\n```\n\n## Pipes {.unnumbered}\n\nUse `%>%` or `|>` to emphasise a sequence of actions, rather than the object that the actions are being performed on.\n\nThe tidyverse has been designed to work particularly well with the pipe, but you can use it with any code, particularly in conjunction with the _ placeholder.\n\n```{r pipes, eval=FALSE}\n\nstrings %>%\n  str_replace(\"a\", \"b\") %>%\n  str_replace(\"x\", \"y\")\n\nstrings |>\n  gsub(\"a\", \"b\", x = _) |>\n  gsub(\"x\", \"y\", x = _)\n\n```\n\nAvoid using the pipe when:\n\n- You need to manipulate more than one object at a time. Reserve pipes for a sequence of steps applied to one primary object.\n- There are meaningful intermediate objects that could be given informative names.\n\n### Long lines {.unnumbered}\n\nIf the arguments to a function don‚Äôt all fit on one line, put each argument on its own line and indent:\n\n```{r long, eval=FALSE}\n\n# Good\niris %>%\n  summarise(\n    Sepal.Length = mean(Sepal.Length),\n    Sepal.Width = mean(Sepal.Width),\n    .by = Species\n  )\n\niris |>\n  summarise(\n    Sepal.Length = mean(Sepal.Length),\n    Sepal.Width = mean(Sepal.Width),\n    .by = Species\n  )\n\n# Bad\niris %>%\n  summarise(Sepal.Length = mean(Sepal.Length), Sepal.Width = mean(Sepal.Width), .by = Species)\n\n```\n\n\nFor data analysis, we recommend using the pipe whenever a function needs to span multiple lines, even if it‚Äôs only a single step.\n\n```{r long 2, eval=FALSE}\n\n# Bad\nsummarise(\n  iris,\n  Sepal.Length = mean(Sepal.Length),\n  Sepal.Width = mean(Sepal.Width),\n  .by = Species\n)\n\n```\n\n\n## Conflict packages {.unnumbered}\n\nTake careful note of the conflicts message that‚Äôs printed when you load the tidyverse. It tells you that dplyr overwrites some functions in base R.\nIf you want to use the base version of these functions after loading dplyr, you‚Äôll need to use their full names: `stats::filter()` and `dplyr::filter()`.\n\n\n:::\n\n## Exercise (15 min) {.unnumbered}\n\nüß™ **Clean the code below**\n\nYour colleague got a new job and you have been promoted to his position where you are taking over his unfinished projects. \nThe ecological data has been collected and some quick analysis was performed.\nBut, you noticed that he didnt perform a quality check on the raw data and the # explanations are not clear.\nThe current state is not suitable for the client so you are assigned to clean.\n\nClean the code where relevent, and check if all the code is working on your end.\n\n**Note**: change the working directory to your folder and load the plant_calcium.csv to work on.\n**Note 2**: The same errors to fix are from the [week 2 - data quality workshop](week2_data_exploration.qmd).\n\n\n```{r ex 2, eval=FALSE}\n\n# Exercise 2\n# Cleaning code and tidying dataset\n# John Smith, 25-03/2025\n\n## Set up ## ----------------------------------------------------------------\nlibrary(tiderVerse)\n\n# Set my directory\nsetwd(\"your working directory\")\n\n## Loading and cleaning data ## ---------------------------------------------\n\n# Load raw data\nplant data <- read_csv(\"data/plant_calcium.csv\")\nstr(plant data)\n\n## Analysis ## -------------------------------------------------------------\n\n# Fit model: height explained by elevation\nmodel <- lm(stem_dry_mass ~ stem_length, data = plant_data)\n\n# Check model summary\nsummary(model)\n\n## Visualisation ## --------------------------------------------------------\n\n# Creating scatterplot figure\nplant_data %>%\n  ggplot() +\n  geom_point(aes(x = stem_length, y = Stem_dry_mass)) +\n  labs(\n    x = \"Stem Length (mm)\",\n    y = \"Stem Dry Mass (g)\",\n    title = \"Stem Dry Mass vs. Stem Length in Sugar Maple Seedlings\",\n    subtitle = \"Hubbard Brook LTER\"\n  ) +\n  theme_minimal()\n\n```\n\n<details>\n<summary><strong>Show answer</strong></summary>\n\n```{r ans 2, eval=FALSE}\n\n# Exercise 2\n# Cleaning code and tidying dataset\n# John Smith, 25-03-2025\n\n## Set up ## ----------------------------------------------------------------\nlibrary(tidyverse)\n\n# Set my directory\nsetwd(\"C:/Users/75002992/OneDrive - Murdoch University/Teaching/ECS200 - Research Methods in Ecology/ECS200 - Workshop/\")\n\n## Loading and cleaning data ## ---------------------------------------------\n\n# Load raw data\nplant_data <- read_csv(\"data/plant_calcium.csv\")\nstr(plant_data)\n\n\n# Correct class type\nplant_data <- plant_data %>%\n  mutate(watershed = as.factor(watershed),\n         elevation = as.factor(elevation))\n\n# Check for missing values in each column\ncolSums(is.na(plant_data))\n\n# Visualise missing data pattern\nvisdat::vis_dat(plant_data_clean)\n\n# Remove NA rows based on missing elevation data\nplant_data <- plant_data %>% \n  drop_na(elevation)\n\n# Check for duplicate rows\nsum(duplicated(plant_data))  # None\n\n# Check for outliers\n\nggplot(plant_data, aes(x = leaf2area)) +\n  geom_histogram() +\n  theme_bw()\n\n# create a clean dataset after filtering the outlier\nplant_data_clean <- plant_data %>%\n  dplyr::filter(leaf2area < 90)\n\n## Analysis ## -------------------------------------------------------------\n\n# Fit model: height explained by elevation\ndry_length_mod <- lm(stem_dry_mass ~ stem_length, data = plant_data_clean)\n\n# Check model summary\nsummary(dry_length_mod)\n\n## Visualisation ## --------------------------------------------------------\n\n# Creating scatterplot figure\nplant_data_clean %>%\n  ggplot() +\n  geom_point(aes(x = stem_length, y = stem_dry_mass)) +\n  labs(\n    x = \"Stem Length (mm)\",\n    y = \"Stem Dry Mass (g)\",\n    title = \"Stem Dry Mass vs. Stem Length in Sugar Maple Seedlings\",\n    subtitle = \"Hubbard Brook LTER\"\n  ) +\n  theme_minimal()\n\n```\n\n</details>\n\n\n# Assessment {.unnumbered}\n\nTask to complete before the end of the workshop.\n\nFortunately, the authors of the study cleaned the data so we do not need to do much data transformation before analysis.\nFor the purpose of future workshops, please filter your `plant_task_data_clean` data by selecting only `year`, `watershed`, `elevation`, `stem_length`, `leaf_dry_mass`, and `stem_dry_mass`.\n\nNext, calculate the total dry mass from `leaf_dry_mass` and `stem_dry_mass` and correct the unit from kilogram to gram.\n\nCreate a separate object to that summarises the mean, standard deviation, and count `plant_task_data_clean` of the total dry mass variable by `watershed` and `year`.\n\nSave this workflow for future workshops.\nRemember to create a header with the next workshop titled ‚Äú*Week 4 workshop - Descriptive statistics*‚Äù, a description called ‚ÄúRun some basis statistical summarise and plotting the data‚Äù, your name, and the next workshops date.\n\n```{r home 1, include=FALSE, eval=FALSE}\n\nplant_data_clean <- plant_task_clean_data %>%\n  dplyr::select(year, watershed, elevation, stem_length, leaf_dry_mass, stem_dry_mass) %>%\n  dplyr::mutate(total_mass_g = (leaf_dry_mass + stem_dry_mass) * 1000)\n\n\nplant_data_clean %>%\n  dplyr::group_by(watershed, year) %>%\n  dplyr::summarise(mean = mean(total_mass_g),\n                   sd   = sd(total_mass_g),\n                   n    = n())\n\n```\n\n\n## For the adventurous folks {.unnumbered}\n\nYou've learned how to use the core `dplyr` verbs ‚Äî now let‚Äôs practice building more powerful and efficient workflows by combining multiple functions in clean, compact code.\n\n**1. Take your cleaned dataset `plant_task_data_clean` and write one pipeline that**:\n\n- Filters only `W1` watershed and year `2004`.\n- Creates a new variable `total_mass_g` from `stem_dry_mass` + `leaf_dry_mass`, multiplied by 1000\n- Selects only the new variable and `stem_length`\n- Filters any rows with `stem_length` greater than 200 mm.\n- Arranges the result by `total_mass_g` in descending order.\n\nUse `%>%` or `|>` and avoid creating intermediate objects.\n\n```{r hard 1, include=FALSE, eval=FALSE}\n\nplant_task_clean_data %>%\n  dplyr::filter(year == 2004 , watershed == \"W1\") %>%\n  dplyr::mutate(total_mass_g = (leaf_dry_mass + stem_dry_mass) * 1000) %>%\n  dplyr::select(total_mass_g, stem_length) %>%\n  dplyr::arrange(desc(total_mass_g))\n\n```\n\n**2. Using `group_by()` and `summarise()` in a single chain**:\n\n- Group the data by `watershed` and `year`.\n- Calculate the mean, coefficient of variation, and count of `total_mass_g`.\n- Arrange by year in ascending order.\n\n```{r home 2, include=FALSE, eval=FALSE}\n\nplant_task_clean_data %>%\n  dplyr::group_by(watershed, year) %>%\n  dplyr::summarise(mean = mean(total_dry_mass_g),\n                   cv   = sd(total_dry_mass_g) / mean * 100, \n                   n    = n())\n\n```\n\n\n**3. Write a function that**:\n\n- Takes a numeric column as input.\n- Filters out outliers using the 1.5 √ó IQR rule.\n- Returns the filtered data.\n\nTry applying it to `leaf_dry_mass` and `stem_length`.\n\n```{r home 3, include=FALSE, eval=FALSE}\n\nremove_outliers <- function(x) {\n  Q1 <- quantile(x, 0.25, na.rm = TRUE)\n  Q3 <- quantile(x, 0.75, na.rm = TRUE)\n  IQR <- Q3 - Q1\n  x > (Q1 - 1.5 * IQR) & x < (Q3 + 1.5 * IQR)\n}\n\n# This returns a logical vector (TRUE = keep, FALSE = outlier).\n\n\n# Keep rows where both variables are within IQR bounds (i.e. not outliers)\nplant_no_outliers <- plant_task_clean_data %>%\n  dplyr::filter(remove_outliers(leaf_dry_mass),\n                remove_outliers(stem_length)\n                )\n\n\nnrow(plant_task_clean_data)  # Original 358\nnrow(plant_no_outliers)      # After filtering 345\n\n```\n\n\n# Extra Stuff {.unnumbered}\n\n- More comprehensive description of the [data transformation](https://r4ds.had.co.nz/transform.html) functions to explore.\n- An animated version that visualises what some of the [tidyverse functions](https://www.garrickadenbuie.com/project/tidyexplain/) do.\nExample animated function `inner_join()`shown below.\n\n![`inner_join()`: All rows from x where there are matching values in y, and all columns from x and y.](images/inner-join.gif)\n\n- Basic [data manipulation](https://ourcodingclub.github.io/tutorials/data-manip-intro/).\n- Efficient [data manipulation](https://ourcodingclub.github.io/tutorials/data-manip-efficient/) (streamline your code).\n- Advanced [data manipulation](https://ourcodingclub.github.io/tutorials/data-manip-creative-dplyr/) (diverse `dplyr` functions).\n\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"week2_tidy_data.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.42","bibliography":["bib/references.bib"],"csl":"bib/the-journal-of-experimental-biology.csl","link-citations":true,"theme":["cosmo","brand"]},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"week2_tidy_data.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"block-headings":true,"bibliography":["bib/references.bib"],"csl":"bib/the-journal-of-experimental-biology.csl","link-citations":true,"documentclass":"scrreprt"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}